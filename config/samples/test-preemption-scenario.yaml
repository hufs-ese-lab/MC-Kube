# Preemption Test Scenario
# Test whether preemption occurs when a High priority Pod is deployed after Middle and Low Pods are placed on Core 2

---
# Step 1: Middle criticality Pod (Assigned to Core 2, 40% CPU usage)
apiVersion: v1
kind: Pod
metadata:
  name: middle-pod
  namespace: default
  labels:
    sdv.com: middle-app
spec:
  containers:
  - name: app
    image: nginx:latest
---
apiVersion: mcoperator.sdv.com/v1
kind: McKube
metadata:
  name: middle-pod-config
  namespace: default
spec:
  podname: middle-pod
  criticality: "Middle"
  rtSettings:
    period: 100000        # 100ms
    runtime_low: 40000    # 40ms → 40% CPU
    runtime_hi: 60000     # 60ms → 60% CPU
    core: "2"             # Assigned to Core 2
---
# Step 2: Low criticality Pod (Assigned to Core 2, 35% CPU usage)
apiVersion: v1
kind: Pod
metadata:
  name: low-pod
  namespace: default
  labels:
    sdv.com: low-app
spec:
  containers:
  - name: app
    image: nginx:latest
---
apiVersion: mcoperator.sdv.com/v1
kind: McKube
metadata:
  name: low-pod-config
  namespace: default
spec:
  podname: low-pod
  criticality: "Low"
  rtSettings:
    period: 100000        # 100ms
    runtime_low: 35000    # 35ms → 35% CPU
    runtime_hi: 50000     # 50ms → 50% CPU
    core: "2"             # Assigned to Core 2
---
# Step 3: High criticality Pod (Attempts assignment to Core 2, 25% CPU usage)
# When this Pod is placed, Core 2 reaches 100% utilization (40% + 35% + 25%), triggering preemption!
apiVersion: v1
kind: Pod
metadata:
  name: high-pod
  namespace: default
  labels:
    sdv.com: high-app
spec:
  containers:
  - name: app
    image: nginx:latest
---
apiVersion: mcoperator.sdv.com/v1
kind: McKube
metadata:
  name: high-pod-config
  namespace: default
spec:
  podname: high-pod
  criticality: "High"
  rtSettings:
    period: 100000        # 100ms
    runtime_low: 25000    # 25ms → 25% CPU
    runtime_hi: 40000     # 40ms → 40% CPU
    core: "2"             # Assigned to Core 2 → Triggers preemption!
